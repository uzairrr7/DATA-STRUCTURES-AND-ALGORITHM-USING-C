#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define HASH_SIZE 1000

typedef struct Node {
    int key;
    int value;
    struct Node* prev;
    struct Node* next;
} Node;

typedef struct {
    int capacity;
    int size;
    Node* head;
    Node* tail;
    Node* hash[HASH_SIZE];
} LRUCache;

Node* createNode(int key, int value) {
    Node* node = (Node*)malloc(sizeof(Node));
    node->key = key;
    node->value = value;
    node->prev = NULL;
    node->next = NULL;
    return node;
}

LRUCache* lRUCacheCreate(int capacity) {
    LRUCache* cache = (LRUCache*)malloc(sizeof(LRUCache));
    cache->capacity = capacity;
    cache->size = 0;
    cache->head = createNode(0, 0);
    cache->tail = createNode(0, 0);
    cache->head->next = cache->tail;
    cache->tail->prev = cache->head;
    memset(cache->hash, 0, sizeof(cache->hash));
    return cache;
}

void removeNode(Node* node) {
    node->prev->next = node->next;
    node->next->prev = node->prev;
}

void addToHead(LRUCache* cache, Node* node) {
    node->next = cache->head->next;
    node->prev = cache->head;
    cache->head->next->prev = node;
    cache->head->next = node;
}

int lRUCacheGet(LRUCache* cache, int key) {
    int hashKey = key % HASH_SIZE;
    Node* node = cache->hash[hashKey];
    
    while (node) {
        if (node->key == key) {
            removeNode(node);
            addToHead(cache, node);
            return node->value;
        }
        node = node->next;
    }
    return -1;
}

void lRUCachePut(LRUCache* cache, int key, int value) {
    int hashKey = key % HASH_SIZE;
    Node* node = cache->hash[hashKey];
    
    // Check if key exists
    while (node) {
        if (node->key == key) {
            node->value = value;
            removeNode(node);
            addToHead(cache, node);
            return;
        }
        node = node->next;
    }
    
    // Create new node
    Node* newNode = createNode(key, value);
    
    if (cache->size >= cache->capacity) {
        // Remove LRU
        Node* lru = cache->tail->prev;
        removeNode(lru);
        int lruHash = lru->key % HASH_SIZE;
        cache->hash[lruHash] = NULL;
        free(lru);
        cache->size--;
    }
    
    addToHead(cache, newNode);
    cache->hash[hashKey] = newNode;
    cache->size++;
}

int main() {
    LRUCache* cache = lRUCacheCreate(2);
    
    lRUCachePut(cache, 1, 1);
    lRUCachePut(cache, 2, 2);
    printf("Get 1: %d\n", lRUCacheGet(cache, 1));
    lRUCachePut(cache, 3, 3);
    printf("Get 2: %d\n", lRUCacheGet(cache, 2));
    lRUCachePut(cache, 4, 4);
    printf("Get 1: %d\n", lRUCacheGet(cache, 1));
    printf("Get 3: %d\n", lRUCacheGet(cache, 3));
    printf("Get 4: %d\n", lRUCacheGet(cache, 4));
    
    return 0;
}
