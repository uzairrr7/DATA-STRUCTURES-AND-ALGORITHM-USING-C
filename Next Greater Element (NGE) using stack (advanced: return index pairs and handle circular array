#include <stdio.h>
#include <stdlib.h>

int* nextGreaterIndicesCircular(int *arr, int n) {
    int *res = malloc(sizeof(int)*n);
    for(int i=0;i<n;i++) res[i] = -1;
    int *stack = malloc(sizeof(int)*n);
    int top=-1;
    for(int i=0;i<2*n;i++){
        int idx = i % n;
        while(top!=-1 && arr[idx] > arr[stack[top]]){
            res[stack[top--]] = idx; // store index of next greater
        }
        if (i < n) // push only original indices once
            stack[++top] = idx;
    }
    free(stack);
    return res;
}

int main(){
    int a[] = {5, 7, 1, 2, 6, 3};
    int n = sizeof(a)/sizeof(a[0]);
    int *res = nextGreaterIndicesCircular(a, n);
    printf("Array: ");
    for(int i=0;i<n;i++) printf("%d ", a[i]);
    printf("\nNext greater indices (circular):\n");
    for(int i=0;i<n;i++){
        if(res[i] == -1) printf("i=%d val=%d -> -1\n", i, a[i]);
        else printf("i=%d val=%d -> idx=%d val=%d\n", i, a[i], res[i], a[res[i]]);
    }
    free(res);
    return 0;
}
